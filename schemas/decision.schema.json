{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.org/bedrock/decision.schema.json",
  "type": "object",
  "required": ["tool","tool_version","git_sha","decision_schema_version","asset_id","token","decision","reason","window","exit_code","ts","correlation_id","checks","posture"],
  "properties": {
    "tool": {"type":"string"},
    "tool_version": {"type":"string"},
    "git_sha": {"type":"string"},
    "decision_schema_version": {"type":"string"},
    "asset_id": {"type":"string"},
    "token": {"type":"string"},
    "decision": {"enum":["allow","block"]},
    "reason": {"type":"string","maxLength":200},
    "window": {
      "oneOf": [
        {"type":"string"},
        {"type":"object","required":["lower_iso","upper_iso"],"properties":{"lower_iso":{"type":"string"},"upper_iso":{"type":"string"}}},
        {"type":"object","required":["since_iso"],"properties":{"since_iso":{"type":"string"}}},
        {"type":"object","required":["until_iso"],"properties":{"until_iso":{"type":"string"}}}
      ]
    },
    "exit_code": {"enum":[0,1,2]},
    "ts": {"type":"string","pattern":"^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$"},
    "correlation_id": {"type":"string"},
    "posture": {"enum":["advice","enforce"]},
    "pack": {"type":"string"},
    "registry_sha": {"type":"string"},
    "run_id": {"type":"string"},
    "checks": {
      "type":"array",
      "maxItems": 32,
      "items": {
        "type":"object",
        "required":["token","ok"],
        "properties":{
          "token":{"type":"string"},
          "ok":{"type":"boolean"},
          "details":{"type":"string","maxLength":256},
          "source":{"type":"string"}
        }
      }
    }
  },
  "additionalProperties": true
}
